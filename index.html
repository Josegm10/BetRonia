<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Djokovic Challenge - Estad√≠sticas Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #004d3d; --accent: #c1ff00; --bg: #f0f4f2; }
        body { font-family: 'Arial', sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; border: 2px solid var(--primary); width: 100%; max-width: 500px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .logo { width: 100%; border-radius: 10px; margin-bottom: 15px; }
        h2, h3, h4 { color: var(--primary); margin: 10px 0; }
        input, button, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ccc; font-size: 15px; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
        
        /* Tabla de Jugadores (Vista Jugador) */
        .info-box { background: #fffde7; border: 2px dashed #fbc02d; padding: 10px; border-radius: 10px; margin-bottom: 15px; overflow-x: auto; }
        .stats-table { width: 100%; border-collapse: collapse; background: white; font-size: 12px; }
        .stats-table th { background: #fbc02d; color: #453505; padding: 8px; border: 1px solid #eab308; }
        .stats-table td { padding: 8px; border: 1px solid #eee; text-align: center; }
        .col-nombre { text-align: left !important; font-weight: bold; }
        .yellow-card { background: #ffeb3b; padding: 2px 6px; border-radius: 3px; font-weight: bold; }
        .red-card { background: #f44336; color: white; padding: 2px 6px; border-radius: 3px; font-weight: bold; }

        /* Estilos Admin */
        .admin-section { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: left; }
        .flex-row { display: flex; gap: 5px; }
    </style>
</head>
<body>

    <div id="admin-ui" class="card hidden">
        <h3>üõ†Ô∏è ADMIN: ESTAD√çSTICAS</h3>
        <div class="admin-section">
            <input type="text" id="info-jugador" placeholder="Nombre del Jugador">
            <input type="text" id="info-pos" placeholder="Posici√≥n (DEL, MED...)">
            <div class="flex-row">
                <input type="number" id="info-goles" placeholder="Goles">
                <input type="number" id="info-ama" placeholder="Amas.">
                <input type="number" id="info-roj" placeholder="Rojas">
            </div>
            <button onclick="guardarFila()" style="background:#22c55e">ACTUALIZAR JUGADOR</button>
            <div id="adm-lista-mini" style="margin-top:10px; font-size:11px;"></div>
        </div>
        <button onclick="window.location.reload()" style="background:#666">Cerrar Admin</button>
    </div>

    <div id="game-ui" class="card">
        <img src="https://i.postimg.cc/FzXJKQQQ/Captura-de-pantalla-2026-02-02-113118.png" class="logo">
        <h3 id="user-tag">@Invitado</h3>
        
        <div id="info-user-view" class="info-box">
            <h4>üìä ESTAD√çSTICAS JUGADORES</h4>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th rowspan="2">Jugador</th>
                        <th rowspan="2">Pos.</th>
                        <th rowspan="2">Goles</th>
                        <th colspan="2">Tarjetas</th>
                    </tr>
                    <tr>
                        <th style="font-size: 10px;">AM</th>
                        <th style="font-size: 10px;">RO</th>
                    </tr>
                </thead>
                <tbody id="stats-body"></tbody>
            </table>
        </div>

        <div id="options-container">Cargando ronda...</div>
        <button onclick="accesoAdmin()" style="background:none; color:#ccc; font-size:10px; margin-top:20px;">Admin Access</button>
    </div>

    <script>
        const SB_URL = 'https://jvjzqodxumblrkiisfva.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp2anpxb2R4dW1ibHJraWlzZnZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5NjY2ODUsImV4cCI6MjA4NTU0MjY4NX0.Y65rnPUEsIkiBZOx1WL2M4ukSr_kDsAq6quyfLOBMCU';
        const sb = supabase.createClient(SB_URL, SB_KEY);

        // --- FUNCIONES ADMIN ---
        async function guardarFila() {
            const jug = document.getElementById('info-jugador').value;
            const pos = document.getElementById('info-pos').value;
            const gol = document.getElementById('info-goles').value || "0";
            const ama = document.getElementById('info-ama').value || "0";
            const roj = document.getElementById('info-roj').value || "0";

            if(!jug) return alert("Nombre de jugador obligatorio");

            // Guardamos en la tabla 'estadisticas'
            // Dato1 = Posici√≥n | Dato2 = Goles | Dato3 = Amarillas | Dato4 = Rojas
            // Nota: He usado campos gen√©ricos de la tabla, aseg√∫rate que existan o env√≠alos como JSON
            await sb.from('estadisticas').upsert({ 
                sujeto: jug, 
                dato1: pos, 
                dato2: gol,
                dato3: ama, // Aseg√∫rate de que tu tabla en Supabase tenga estas columnas
                dato4: roj 
            }, { onConflict: 'sujeto' });

            limpiarCampos();
        }

        function limpiarCampos() {
            document.querySelectorAll('.admin-section input').forEach(i => i.value = "");
        }

        function accesoAdmin() {
            if(prompt("Clave:") === "1234") {
                document.getElementById('admin-ui').classList.remove('hidden');
                document.getElementById('game-ui').classList.add('hidden');
            }
        }

        // --- REFRESCAR DATOS ---
        async function refrescar() {
            const { data: stats } = await sb.from('estadisticas').select('*').order('sujeto');
            
            const body = document.getElementById('stats-body');
            body.innerHTML = stats.map(s => `
                <tr>
                    <td class="col-nombre">${s.sujeto}</td>
                    <td>${s.dato1 || '-'}</td>
                    <td style="font-weight:bold">${s.dato2 || '0'}</td>
                    <td><span class="yellow-card">${s.dato3 || '0'}</span></td>
                    <td><span class="red-card">${s.dato4 || '0'}</span></td>
                </tr>
            `).join('');

            // Lista r√°pida en admin para borrar
            if(!document.getElementById('admin-ui').classList.contains('hidden')) {
                document.getElementById('adm-lista-mini').innerHTML = stats.map(s => `
                    <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                        <span>${s.sujeto}</span>
                        <button onclick="borrarFila('${s.sujeto}')" class="btn-mini" style="background:red">X</button>
                    </div>
                `).join('');
            }
        }

        async function borrarFila(s) {
            if(confirm("¬øBorrar?")) await sb.from('estadisticas').delete().eq('sujeto', s);
        }

        // Suscripci√≥n Realtime
        sb.channel('cambios').on('postgres_changes', { event: '*', schema: 'public' }, () => refrescar()).subscribe();
        refrescar();
    </script>
</body>
</html>
